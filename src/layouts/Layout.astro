---
interface Props {
	title?: string;
}

const { title = "saahil" } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
	</head>
	<body>
		<div class="scanlines"></div>

		<header class="site-header">
			<div class="site-header-inner">
				<a href="/" class="brand" aria-label="saahil home">s</a>
				<nav class="site-nav">
					<a href="/about">about</a>
					<a href="/work">work</a>
					<a href="/mind">mind</a>
				</nav>
			</div>
		</header>

		<main class="site-main">
			<slot />
		</main>

		<footer class="site-footer">
			<div class="site-footer-inner">
				<span class="footer-label">Listening to:</span>
				<span class="footer-track" id="listening-track">blah blah blah</span>
			</div>
		</footer>
	</body>
</html>

<script>
	const LASTFM_USER = 'YOUR_LASTFM_USERNAME';
	const LASTFM_API_KEY = 'YOUR_LASTFM_API_KEY';

	async function fetchListeningTrack() {
		const el = document.getElementById('listening-track');
		if (!el || !LASTFM_USER || !LASTFM_API_KEY) return;

		try {
			const url = new URL('https://ws.audioscrobbler.com/2.0/');
			url.searchParams.set('method', 'user.getrecenttracks');
			url.searchParams.set('user', LASTFM_USER);
			url.searchParams.set('api_key', LASTFM_API_KEY);
			url.searchParams.set('format', 'json');
			url.searchParams.set('limit', '1');

			const res = await fetch(url.toString());
			if (!res.ok) throw new Error('request failed');

			const data = await res.json();
			const track = data?.recenttracks?.track?.[0] ?? data?.recenttracks?.track;

			if (!track) {
				el.textContent = 'nothing recently played.';
				return;
			}

			const name = track.name;
			const artist = track.artist?.['#text'] ?? '';
			const nowPlaying = track['@attr']?.nowplaying === 'true';

			el.textContent = nowPlaying
				? `now playing: ${name} — ${artist}`
				: `${name} — ${artist}`;
		} catch {
			const el = document.getElementById('listening-track');
			if (el) el.textContent = 'unable to load right now.';
		}
	}

	fetchListeningTrack();
</script>

<style is:global>
	@font-face {
		font-family: 'Daydream';
		src: url('/fonts/Daydream DEMO.otf') format('opentype');
		font-weight: 400;
		font-style: normal;
		font-display: swap;
	}

	* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
	}

	:root {
		--bg-dark: #0a0a0a;
		--bg-medium: #1a1a1a;
		--text-primary: #e0e0e0;
		--text-secondary: #888888;
	}

	html {
		font-size: 16px;
		scroll-behavior: smooth;
	}

	body {
		font-family: 'Daydream', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
		background: var(--bg-dark);
		color: var(--text-primary);
		min-height: 100vh;
		overflow-x: hidden;
		position: relative;
	}

	.scanlines {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		pointer-events: none;
		z-index: 0;
		background: repeating-linear-gradient(
			0deg,
			transparent,
			transparent 2px,
			rgba(0, 0, 0, 0.2) 2px,
			rgba(0, 0, 0, 0.2) 4px
		);
	}

	.site-header {
		position: sticky;
		top: 0;
		z-index: 1;
		backdrop-filter: blur(16px);
		background: linear-gradient(to bottom, rgba(5, 5, 5, 0.96), rgba(5, 5, 5, 0.85));
		border-bottom: 1px solid rgba(255, 255, 255, 0.06);
	}

	.site-header-inner {
		max-width: 960px;
		margin: 0 auto;
		padding: 0.9rem 1.5rem;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 1.5rem;
	}

	.brand {
		font-size: 0.85rem;
		letter-spacing: 0.08em;
		text-transform: lowercase;
	}

	.site-nav {
		display: flex;
		align-items: center;
		gap: 1.5rem;
		font-size: 1rem;
	}

	.site-main {
		max-width: 960px;
		margin: 0 auto;
		padding: 2.5rem 1.5rem 3rem;
		position: relative;
		z-index: 1;
	}

	.site-footer {
		position: relative;
		z-index: 1;
		border-top: 1px solid rgba(255, 255, 255, 0.06);
	}

	.site-footer-inner {
		max-width: 960px;
		margin: 0 auto;
		padding: 0.9rem 1.5rem 1.5rem;
		display: flex;
		gap: 0.5rem;
		align-items: baseline;
		font-size: 0.95rem;
		color: var(--text-secondary);
	}

	.footer-label {
		font-weight: normal;
	}

	.footer-track {
		color: var(--text-primary);
	}

	::selection {
		background: var(--text-primary);
		color: var(--bg-dark);
	}

	::-webkit-scrollbar {
		width: 8px;
	}

	::-webkit-scrollbar-track {
		background: var(--bg-dark);
	}

	::-webkit-scrollbar-thumb {
		background: var(--text-secondary);
	}

	a {
		color: var(--text-primary);
		text-decoration: none;
	}

	a:hover {
		color: #ffffff;
	}
</style>
