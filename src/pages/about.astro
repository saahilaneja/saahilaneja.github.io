---
import Layout from '../layouts/Layout.astro';

const apiKey = import.meta.env.PUBLIC_LASTFM_API_KEY;

async function getTopAlbums(artist: string, limit = 6) {
  if (!apiKey) return [];
  const url = new URL('https://ws.audioscrobbler.com/2.0/');
  url.searchParams.set('method', 'artist.gettopalbums');
  url.searchParams.set('artist', artist);
  url.searchParams.set('api_key', apiKey);
  url.searchParams.set('format', 'json');
  url.searchParams.set('limit', String(limit));
  const res = await fetch(url.toString());
  if (!res.ok) return [];
  const data = await res.json();
  const albums = data?.topalbums?.album ?? [];
  return albums
    .filter((a: any) => a.image?.length)
    .map((a: any) => {
      const imgs = Array.isArray(a.image) ? a.image : [];
      const large = imgs.find((i: any) => i.size === 'large' && i['#text']);
      const med = imgs.find((i: any) => i.size === 'medium' && i['#text']);
      const img = large?.['#text'] || med?.['#text'] || imgs[0]?.['#text'] || '';
      return { name: a.name ?? '', imageUrl: img };
    })
    .filter((a: { imageUrl: string }) => a.imageUrl);
}

const [rockyAlbums, kendrickAlbums] = await Promise.all([
  getTopAlbums('A$AP Rocky', 8),
  getTopAlbums('Kendrick Lamar', 8),
]);
const vinylCovers = [...rockyAlbums, ...kendrickAlbums];
---

<Layout title="about - saahil">
  <main class="page">
    <header class="page-header">
      <h1>about</h1>
      <p>Blah blah blah blah blah blah blah blah blah blah blah blah.</p>
    </header>

    <section class="about-layout">
      <div class="about-story">
        <p>
          Blah blah blah blah blah blah blah blah blah blah blah blah
          blah blah blah blah blah blah blah blah blah blah blah blah.
        </p>
        <p>
          Blah blah blah blah blah blah blah blah blah blah blah blah
          blah blah blah blah blah blah blah blah blah blah blah blah
          blah blah blah blah blah blah.
        </p>
        <p>
          Blah blah blah blah blah blah blah blah blah blah blah blah
          blah blah blah blah blah blah blah blah.
        </p>
      </div>

      <section class="section about-main">
        <h2>my favorites</h2>

        {vinylCovers.length > 0 && (
          <>
            <p class="vinyl-label">vinyl collection</p>
            <div class="vinyl-scroll-wrap" aria-hidden="true">
              <div class="vinyl-scroll-track">
                {vinylCovers.map((a) => (
                  <a class="vinyl-cover" title={a.name}>
                    <img src={a.imageUrl} alt={a.name} width="160" height="160" loading="lazy" />
                  </a>
                ))}
                {vinylCovers.map((a) => (
                  <a class="vinyl-cover" title={a.name}>
                    <img src={a.imageUrl} alt={a.name} width="160" height="160" loading="lazy" />
                  </a>
                ))}
              </div>
            </div>
          </>
        )}

        <div class="favorites">
          <div class="favorite-group">
            <h3 class="favorite-category">games</h3>
            <ul class="favorite-items">
              <li>Persona 3</li>
              <li>VA-11 Hall-A</li>
              <li>Fields of Mistria</li>
            </ul>
          </div>

          <div class="favorite-group">
            <h3 class="favorite-category">books</h3>
            <ul class="favorite-items">
              <li>No Longer Human</li>
              <li>The Metamorphosis</li>
              <li>Goodnight Punpun</li>
            </ul>
          </div>

          <div class="favorite-group">
            <h3 class="favorite-category">music</h3>
            <ul class="favorite-items">
              <li>ASAP Rocky</li>
              <li>Sampha</li>
              <li>N.E.R.D.</li>
            </ul>
          </div>

          <div class="favorite-group">
            <h3 class="favorite-category">movies</h3>
            <ul class="favorite-items">
              <li>Scott Pilgrim</li>
              <li>Look Back</li>
              <li>Her</li>
            </ul>
          </div>
        </div>
      </section>
    </section>

    <footer class="page-footer">
      <a href="/">home</a>
      <span>Â·</span>
      <a href="/work">work</a>
    </footer>
  </main>
</Layout>

<script>
  import $ from 'jquery';
  import tilt from 'tilt.js';
  tilt(window, $);
  $(function () {
    $('.vinyl-cover').tilt({
      maxTilt: 28,
      perspective: 600,
      glare: true,
      maxGlare: 0.25,
      scale: 1,
      speed: 350,
    });
  });
</script>

<style>
  .page {
    display: flex;
    flex-direction: column;
    gap: 2.25rem;
  }

  .page-header h1 {
    font-size: clamp(1.4rem, 3vw, 2rem);
    margin-bottom: 0.4rem;
    text-transform: lowercase;
  }

  .page-header p {
    color: var(--text-secondary);
    font-size: 1.05rem;
    max-width: 36rem;
  }

  .about-layout {
    display: grid;
    grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
    gap: 2rem;
    align-items: flex-start;
  }

  .about-story {
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
  }

  .about-story p {
    color: var(--text-secondary);
    font-size: 1.05rem;
    max-width: 34rem;
  }

  .section {
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
  }

  .section h2 {
    font-size: 1.1rem;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text-secondary);
  }

  .about-main {
    max-width: 32rem;
  }

  .vinyl-scroll-wrap {
    margin: 1rem 0 1.25rem;
    padding: 28px 0;
    overflow: hidden;
    mask-image: linear-gradient(to right, transparent, black 8%, black 92%, transparent);
    -webkit-mask-image: linear-gradient(to right, transparent, black 8%, black 92%, transparent);
  }

  .vinyl-label {
    font-size: 0.8rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }

  .vinyl-scroll-track {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    width: max-content;
    animation: vinyl-scroll 45s linear infinite;
    margin: -28px 0;
  }

  @media (prefers-reduced-motion: reduce) {
    .vinyl-scroll-track {
      animation: none;
    }
  }

  .vinyl-scroll-track:hover {
    animation-play-state: paused;
  }

  .vinyl-cover {
    flex-shrink: 0;
    width: 88px;
    height: 88px;
    border-radius: 10px;
    overflow: hidden;
    border: 2px solid rgba(255, 255, 255, 0.06);
    box-shadow:
      0 4px 12px rgba(0, 0, 0, 0.4),
      0 0 0 1px rgba(255, 255, 255, 0.04) inset;
    transition: border-color 0.2s ease, box-shadow 0.25s ease;
  }

  .vinyl-cover:hover {
    border-color: rgba(192, 132, 252, 0.35);
    box-shadow:
      0 8px 24px rgba(0, 0, 0, 0.5),
      0 0 20px rgba(192, 132, 252, 0.12),
      0 0 0 1px rgba(255, 255, 255, 0.08) inset;
  }

  .vinyl-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    pointer-events: none;
  }

  @keyframes vinyl-scroll {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-50%);
    }
  }

  .favorites {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 0.75rem;
  }

  .favorite-group {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }

  .favorite-category {
    font-size: 0.85rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-secondary);
  }

  .favorite-items {
    list-style: none;
    padding-left: 0;
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
    font-size: 0.98rem;
  }

  .favorite-items li {
    color: var(--text-primary);
  }

  .page-footer {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    color: var(--text-secondary);
    margin-top: 1.5rem;
  }

  @media (max-width: 768px) {
    .about-layout {
      grid-template-columns: minmax(0, 1fr);
      gap: 1.75rem;
    }
  }
</style>