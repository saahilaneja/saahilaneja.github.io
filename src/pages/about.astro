---
import Layout from '../layouts/Layout.astro';

const apiKey = import.meta.env.PUBLIC_LASTFM_API_KEY;

const ALBUMS = [
  { artist: 'A$AP Rocky', album: 'At Long Last A$AP' },
  { artist: 'Kendrick Lamar', album: 'To Pimp a Butterfly' },
  { artist: 'Frank Ocean', album: 'Blonde' },
  { artist: 'Nujabes', album: 'Modal Soul' },
  { artist: 'Sampha', album: 'Lahai' },
  { artist: 'N.E.R.D.', album: 'Seeing Sounds' },
  { artist: 'TV Girl', album: 'Who Really Cares' },
];

async function getAlbumCover(artist, album) {
  if (!apiKey) return null;
  const url = new URL('https://ws.audioscrobbler.com/2.0/');
  url.searchParams.set('method', 'album.getinfo');
  url.searchParams.set('artist', artist);
  url.searchParams.set('album', album);
  url.searchParams.set('api_key', apiKey);
  url.searchParams.set('format', 'json');
  const res = await fetch(url.toString());
  if (!res.ok) return null;
  const data = await res.json();
  const a = data?.album;
  if (!a?.image?.length) return null;
  const imgs = Array.isArray(a.image) ? a.image : [];
  const large = imgs.find((i) => i.size === 'large' && i['#text']);
  const med = imgs.find((i) => i.size === 'medium' && i['#text']);
  const imageUrl = large?.['#text'] || med?.['#text'] || imgs[0]?.['#text'] || '';
  if (!imageUrl) return null;
  return { name: a.name ?? album, imageUrl };
}

const vinylCovers = (await Promise.all(ALBUMS.map(({ artist, album }) => getAlbumCover(artist, album)))).filter(Boolean);
---

<Layout title="about - saahil">
  <main class="page">
    <header class="page-header">
      <h1>about</h1>
      <p>Blah blah blah blah blah blah blah blah blah blah blah blah.</p>
    </header>

    <section class="about-layout">
      <div class="about-story">
        <p>
          Blah blah blah blah blah blah blah blah blah blah blah blah
          blah blah blah blah blah blah blah blah blah blah blah blah.
        </p>
        <p>
          Blah blah blah blah blah blah blah blah blah blah blah blah
          blah blah blah blah blah blah blah blah blah blah blah blah
          blah blah blah blah blah blah.
        </p>
        <p>
          Blah blah blah blah blah blah blah blah blah blah blah blah
          blah blah blah blah blah blah blah blah.
        </p>
      </div>

      <section class="section favorites-section">
        <h2>my favorites</h2>
        <div class="favorites">
          <div class="favorite-group">
            <h3 class="favorite-category">games</h3>
            <ul class="favorite-items">
              <li>Persona 3</li>
              <li>VA-11 Hall-A</li>
              <li>Fields of Mistria</li>
            </ul>
          </div>

          <div class="favorite-group">
            <h3 class="favorite-category">books</h3>
            <ul class="favorite-items">
              <li>No Longer Human</li>
              <li>The Metamorphosis</li>
              <li>Goodnight Punpun</li>
            </ul>
          </div>

          <div class="favorite-group favorite-group-music">
            <h3 class="favorite-category">music</h3>
            {vinylCovers.length > 0 ? (
              <div class="vinyl-scroll-wrap" aria-hidden="true">
                <div class="vinyl-scroll-track">
                  {vinylCovers.map((a) => (
                    <a class="vinyl-cover" title={a.name}>
                      <img src={a.imageUrl} alt={a.name} width="320" height="320" loading="lazy" />
                    </a>
                  ))}
                  {vinylCovers.map((a) => (
                    <a class="vinyl-cover" title={a.name}>
                      <img src={a.imageUrl} alt={a.name} width="320" height="320" loading="lazy" />
                    </a>
                  ))}
                </div>
              </div>
            ) : (
              <ul class="favorite-items">
                <li>ASAP Rocky</li>
                <li>Sampha</li>
                <li>N.E.R.D.</li>
              </ul>
            )}
          </div>

          <div class="favorite-group">
            <h3 class="favorite-category">movies</h3>
            <ul class="favorite-items">
              <li>Scott Pilgrim</li>
              <li>Look Back</li>
              <li>Her</li>
            </ul>
          </div>
        </div>
      </section>
    </section>

    <footer class="page-footer">
      <a href="/">home</a>
      <span>Â·</span>
      <a href="/work">work</a>
    </footer>
  </main>
</Layout>

<script>
  import $ from 'jquery';
  import tilt from 'tilt.js';
  tilt(window, $);
  $(function () {
    $('.vinyl-cover').tilt({
      maxTilt: 28,
      perspective: 600,
      glare: true,
      maxGlare: 0.4,
      scale: 1,
      speed: 350,
    });
  });
</script>

<style>
  .page {
    display: flex;
    flex-direction: column;
    gap: 2.25rem;
  }

  .page-header h1 {
    font-size: clamp(1.4rem, 3vw, 2rem);
    margin-bottom: 0.4rem;
    text-transform: lowercase;
  }

  .page-header p {
    color: var(--text-secondary);
    font-size: 1.05rem;
    max-width: 36rem;
  }

  .about-layout {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
  }

  .about-story {
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
  }

  .about-story p {
    color: var(--text-secondary);
    font-size: 1.05rem;
    max-width: none;
  }

  .section {
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
  }

  .section h2 {
    font-size: 1.1rem;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text-secondary);
  }

  .vinyl-scroll-wrap {
    margin: 0.5rem 0 0;
    padding: 40px 0;
    overflow: hidden;
    mask-image: linear-gradient(to right, transparent, black 6%, black 94%, transparent);
    -webkit-mask-image: linear-gradient(to right, transparent, black 6%, black 94%, transparent);
  }

  .vinyl-scroll-track {
    display: flex;
    align-items: center;
    gap: 1rem;
    width: max-content;
    animation: vinyl-scroll 50s linear infinite;
    margin: -40px 0;
  }

  @media (prefers-reduced-motion: reduce) {
    .vinyl-scroll-track {
      animation: none;
    }
  }

  .vinyl-scroll-track:hover {
    animation-play-state: paused;
  }

  .vinyl-cover {
    position: relative;
    flex-shrink: 0;
    width: 200px;
    height: 200px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
  }

  .vinyl-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    pointer-events: none;
  }

  .vinyl-cover .js-tilt-glare {
    border-radius: 8px;
  }

  .vinyl-cover .js-tilt-glare-inner {
    background: linear-gradient(
      105deg,
      transparent 30%,
      rgba(255, 255, 255, 0.5) 50%,
      transparent 70%
    );
    border-radius: 8px;
  }

  .favorite-group-music .vinyl-scroll-wrap {
    margin-top: 0.4rem;
  }

  .favorites-section {
    margin-top: 0.5rem;
  }

  @keyframes vinyl-scroll {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-50%);
    }
  }

  .favorites {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 0.75rem;
  }

  .favorite-group {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }

  .favorite-category {
    font-size: 0.85rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-secondary);
  }

  .favorite-items {
    list-style: none;
    padding-left: 0;
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
    font-size: 0.98rem;
  }

  .favorite-items li {
    color: var(--text-primary);
  }

  .page-footer {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    color: var(--text-secondary);
    margin-top: 1.5rem;
  }

  @media (max-width: 768px) {
    .vinyl-cover {
      width: 160px;
      height: 160px;
    }
  }
</style>